{% extends "base.html" %}

{% block title %}Home - Movie Reservation System{% endblock %}

{% block content %}
<div class="hero-section text-center py-5 mb-5">
    <h1 class="display-4 fw-bold mb-3">
        <i class="fas fa-film text-danger me-3"></i>Book Your Movie Experience
    </h1>
    <p class="lead text-muted mb-4">Browse the latest movies, select your seats, and book tickets instantly</p>
    
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="input-group input-group-lg">
                <span class="input-group-text bg-dark border-secondary">
                    <i class="fas fa-search text-muted"></i>
                </span>
                <input type="text" id="searchInput" class="form-control bg-dark border-secondary text-white" placeholder="Search movies by title or genre...">
            </div>
        </div>
    </div>
</div>

<div class="row g-4" id="moviesGrid">
    {% for movie in movies %}
    <div class="col-sm-6 col-md-4 col-lg-3 movie-card" data-title="{{ movie.title|lower }}" data-genre="{{ movie.genre|lower if movie.genre else '' }}">
        <div class="card h-100 bg-dark border-secondary movie-hover">
            <div class="poster-container">
                <img src="{{ movie.poster_url if movie.poster_url and movie.poster_url != 'N/A' else url_for('static', filename='images/no-poster.png') }}" 
                     class="card-img-top movie-poster" 
                     alt="{{ movie.title }}"
                     onerror="this.src='https://via.placeholder.com/300x450/1a1a1a/666666?text=No+Poster'">
                {% if movie.rating and movie.rating != 'N/A' %}
                <span class="rating-badge">
                    <i class="fas fa-star text-warning me-1"></i>{{ movie.rating }}
                </span>
                {% endif %}
            </div>
            <div class="card-body d-flex flex-column">
                <h5 class="card-title text-truncate">{{ movie.title }}</h5>
                <p class="card-text text-muted small mb-2">
                    <i class="fas fa-calendar me-1"></i>{{ movie.release_year }}
                    {% if movie.genre %}
                    <span class="ms-2"><i class="fas fa-tag me-1"></i>{{ movie.genre.split(',')[0] }}</span>
                    {% endif %}
                </p>
                <p class="card-text text-muted small flex-grow-1">{{ movie.description[:100] }}{% if movie.description|length > 100 %}...{% endif %}</p>
                <a href="{{ url_for('movie_details', movie_id=movie.id) }}" class="btn btn-danger mt-auto">
                    <i class="fas fa-ticket-alt me-2"></i>View Details
                </a>
            </div>
        </div>
    </div>
    {% else %}
    <div class="col-12 text-center py-5">
        <i class="fas fa-film fa-5x text-muted mb-4"></i>
        <h3 class="text-muted">No movies available</h3>
        <p class="text-muted">Please run the database initialization script to fetch movies.</p>
    </div>
    {% endfor %}
</div>

<div id="noResults" class="text-center py-5 d-none">
    <i class="fas fa-search fa-4x text-muted mb-4"></i>
    <h3 class="text-muted">No movies found</h3>
    <p class="text-muted">Try a different search term</p>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.getElementById('searchInput').addEventListener('input', function(e) {
    const searchTerm = e.target.value.toLowerCase().trim();
    const movieCards = document.querySelectorAll('.movie-card');
    let visibleCount = 0;
    
    movieCards.forEach(card => {
        const title = card.dataset.title;
        const genre = card.dataset.genre;
        
        if (title.includes(searchTerm) || genre.includes(searchTerm)) {
            card.classList.remove('d-none');
            visibleCount++;
        } else {
            card.classList.add('d-none');
        }
    });
    
    document.getElementById('noResults').classList.toggle('d-none', visibleCount > 0);
});
</script>
{% endblock %}
